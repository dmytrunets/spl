#!/bin/bash

behat_cmd='./bin/behat -c app/config/behat.yml --ansi'

# This sections need when we test Symfony2 application and we need database
# with sample data
# cmd='php app/console --ansi -e=test '
# $cmd doctrine:database:create
# $cmd doctrine:schema:drop --force
# $cmd doctrine:schema:create
# $cmd doctrine:fixtures:load --append
# $cmd cache:cleaer --env=test --no-debug

result=0
if [[ $1 == 'add' && $2 ]]; then
    $behat_cmd --init $2
elif [[ $1 && $1 != 'add' ]]; then
    echo Testing $1
    $behat_cmd $1
else
    for dir in src/App/*/Features; do
        dir=${dir%*/Features}
        echo Testing App${dir##*/}
        $behat_cmd @App${dir##*/}
        [ $? -ne 0 ] && result=1
    done
fi

# $cmd doctrine:database:drop --force

exit $result
